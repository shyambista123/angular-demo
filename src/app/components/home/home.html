<app-header />
<div class="bg-gray-100 min-h-screen font-serif text-gray-900 antialiased">
    <div class="container mx-auto px-6 py-12 lg:px-12 lg:py-16">
        <div class="text-center mb-8">
            <button (click)="openModal('add')"
                class="px-8 py-3 bg-emerald-600 text-white rounded-lg shadow-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-all duration-200">
                Create New Post
            </button>
        </div>
        <main class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            @for(post of posts; track post.id) {
            <div class="col-span-1">
                <article
                    class="p-6 bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-300">
                    <div>
                        <h3 routerLink="post/{{post.id}}"
                            class="text-2xl line-clamp-2 font-medium text-gray-900 hover:text-indigo-600 cursor-pointer transition-colors duration-200">
                            {{ post.title }}
                        </h3>
                        <p class="text-gray-600 text-base mt-3 line-clamp-3 leading-relaxed">{{ post.content }}</p>
                        <p class="text-sm text-gray-500 mt-3 font-light italic">
                            By {{ post.authorName }} | {{ post.createdAt | date: 'mediumDate' }}
                        </p>
                    </div>
                    <div class="mt-6 flex gap-6 justify-end">
                        @if((currentUserId | async) == post.authorId) {
                        <ng-icon style="color: #EF4444;" name="heroTrash"
                            class="h-6 w-6 cursor-pointer hover:text-red-500 transition-colors duration-200"
                            (click)="confirmDelete(post.id)" />
                        <ng-icon style="color: #4B5563;" name="heroPencilSquare"
                            class="h-6 w-6 cursor-pointer hover:text-indigo-600 transition-colors duration-200"
                            (click)="showEditForm(post.id)" />
                        }
                    </div>
                </article>
            </div>
            }
            @if(posts.length === 0) {
            <div class="col-span-full text-center bg-white p-16 rounded-xl shadow-md border border-gray-200">
                <h3 class="text-2xl font-medium text-gray-900">No Posts Available</h3>
                <p class="text-gray-600 mt-3 text-base">Start the conversation by creating your first post.</p>
            </div>
            }
        </main>
        @if(posts.length === 0) {
        <div class="mt-12 text-center">
            <button routerLink="/posts"
                class="px-8 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200">
                View All Posts
            </button>
        </div>
        }
    </div>
</div>
<app-modal [title]="'Create New Post'" [isOpen]="modalOpen('add')" (closed)="onModalClosed()"
    (confirmed)="onModalConfirmedCreatePost()">
    <form [formGroup]="postAddForm" class="space-y-6">
        <input type="text" formControlName="title" placeholder="Enter post title"
            class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-colors duration-200" />
        @if (titleCreate?.hasError('required') && titleCreate?.touched) {
        <span class="text-xs font-medium text-red-500">Title is required</span>
        }
        @if(titleCreate?.hasError('minlength')){
        <span class="text-xs font-medium text-red-500">Title is required and at least should have 5 character</span>
        }
        <textarea formControlName="content" placeholder="Enter post content" rows="6"
            class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-colors duration-200"></textarea>
        @if (contentCreate?.hasError('required') && contentCreate?.touched) {
        <span class="text-xs font-medium text-red-500">Content is required</span>
        }
    </form>
</app-modal>
<app-modal [title]="'Edit Post'" [isOpen]="modalOpen('edit')" (closed)="onModalClosed()"
    (confirmed)="onModalConfirmedUpdatePost()">
    <form [formGroup]="postUpdateForm" class="space-y-6">
        <input type="text" formControlName="title" name="title" placeholder="Enter post title"
            class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-colors duration-200" />
        @if (titleUpdate?.hasError('required') && titleUpdate?.touched) {
        <span class="text-xs font-medium text-red-500">Title is required</span>
        }
        @if(titleUpdate?.hasError('minlength')){
        <span class="text-xs font-medium text-red-500">Title is required and at least should have 5 character</span>
        }
        <textarea formControlName="content" placeholder="Enter post content" name="content" rows="6"
            class="w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-colors duration-200"></textarea>
        @if (contentUpdate?.hasError('required') && contentCreate?.touched) {
        <span class="text-xs font-medium text-red-500">Content is required</span>
        }
    </form>
</app-modal>
<app-modal [title]="'Confirm Deletion'" [isOpen]="modalOpen('delete')" (closed)="onModalClosed()"
    (confirmed)="onModalConfirmedDeletePost()">
    <p class="text-gray-700 text-base">Are you sure you want to delete this post?</p>
</app-modal>